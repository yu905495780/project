define(["config/ifpConfig","service/ifpAPIService","service/ifpJumpService","filter/toTrustFilter"],function(e){e.controller("ifpShowCtrl",["$rootScope","$scope","$http","$location","$filter","$q","$stateParams","$timeout","$uibModal","IFPAPIService","IFPJumpService",function(e,t,i,n,r,a,o,c,s,u,l,d){function f(e){var t=a.defer();return i({method:"post",data:{id:e},url:b+"policy/queryById",timeout:1e4}).success(function(e){t.resolve(e)}).error(function(e,i){t.reject(i)}),t.promise}function p(e){var t=a.defer();return i({method:"post",data:{originId:e},url:b+"policy/originData",timeout:1e4}).success(function(e){t.resolve(e)}).error(function(e,i){t.reject(i)}),t.promise}function g(e){var t={},i={0:"已挂起",1:"投放中",2:"已删除",3:"已失效"},n={0:"text-primary",1:"text-success",2:"text-danger",3:"text-muted"};if(t.status=i[e.status+""],t.statusStyle=n[e.status+""],t.id=e.id,t.mainFileGroupCode=e.mainFileGroupCode,t.externalId=e.externalId,t.productType={0:"直销",2:"特惠",1:"清舱产品"}[e.productType],t.stockType={0:"见舱"}[e.stockType],t.bCanRt={1:"是",0:"否"}[e.bCanRt],1==e.bCanRt&&(t.canGroupFileCode=e.canGroupFileCode),t.airline=e.airline,t.addressOption={1:"机场",2:"城市"}[e.addressOption],t.depCities=e.depCities,t.isTransfer={1:"是",0:"否"}[e.isTransfer],e.isTransfer&&(t.transferCities=e.transferCities),t.arrCities=e.arrCities,t.cabin=e.cabin,t.grade={1:"经济",2:"超值经济",3:"公务",4:"头等"}[e.grade],t.segmentAirlines=e.segmentAirlines,t.segmentFlightAllow=e.segmentFlightAllow||"无限制",t.segmentFlightDeny=e.segmentFlightDeny||"无限制",t.canDepStay={0:"不允许",1:"允许"}[e.canDepStay],t.canRetStay={0:"不允许",1:"允许"}[e.canRetStay],t.sale=e.saleStart+" 至 "+e.saleEnd,t.dateRestrictGo=e.dateRestrictGo.split(">").join(" 至 "),t.dateRestrictGoForbid=[],e.dateRestrictGoForbid.trim()){var r=e.dateRestrictGoForbid.split(",");_.each(r,function(e,i){t.dateRestrictGoForbid.push(e.replace(">"," 至 "))})}if(v&&(t.dateRestrictReturn=e.dateRestrictReturn.split(">").join(" 至 "),t.dateRestrictReturnForbid=[],e.dateRestrictReturnForbid.trim())){var a=e.dateRestrictReturnForbid.split(",");_.each(a,function(e,i){t.dateRestrictReturnForbid.push(e.replace(">"," 至 "))})}e.advancedSaleDate&&(t.advancedSaleDate=e.advancedSaleDate+"天"),t.timeLimitType={0:"支付成功后",1:"航班起飞前"}[e.timeLimitType],t.limitTime=e.limitTime,t.minStay=e.minStay,t.maxStay=e.maxStay,t.weekRestrictGo=e.weekRestrictGo,t.weekRestrictReturn=e.weekRestrictReturn,t.minPeopleNum=e.minPeopleNum,t.maxPeopleNum=e.maxPeopleNum;var o=e.passengerType.split(","),c=[],s={1:"普通成人",0:"儿童",2:"学生"};_.each(o,function(e,t){c.push(s[e])}),t.passengerType=c.join(" "),t.filePrice=e.filePrice,_.indexOf(o,"0")>=0&&(t.filePriceChild=e.filePriceChild),t.currency={CNY:"人民币"}[e.currency],t.saleRetention=e.saleRetention+"%",t.saleRebase=e.saleRebase,t.reserveType={1:"同程预订",2:"已绑定预订配置"}[e.reserveType],1==e.reserveType&&(t.officeNo=e.officeNo);return t.canReimbursementVoucher={1:"发票",0:"行程单"}[e.canReimbursementVoucher],t.canChange={0:"不允许",1:"允许"}[e.canChange],1==e.canChange&&(t.changeFeeDep=e.changeFeeDep||""),t.canChangeRet={0:"不允许",1:"允许"}[e.canChangeRet],1==e.canChangeRet&&(t.changeFeeRet=e.changeFeeRet||""),t.canRefund={0:"不允许",1:"允许"}[e.canRefund],1==e.canRefund&&(t.refundFeeAllUnused=e.refundFeeAllUnused),t.canRefundPartUnused={0:"不允许",1:"允许"}[e.canRefundPartUnused],1==e.canRefundPartUnused&&(t.refundFeePartUnused=e.refundFeePartUnused),t.noShowRestrict={0:"不允许",1:"允许"}[e.noShowRestrict],1==e.noShowRestrict&&(t.noShowFee=e.noShowFee||"不涉及",t.noShowRemark=e.noShowRemark||"不涉及"),t.buyTicketNotice=e.buyTicketNotice||"不涉及",t.luggageType={1:"KG/公斤",2:"PC/件数"}[e.luggageType],t.luggageWeightsBags=e.luggageWeightsBags,t.canInvalid={1:"允许",0:"不允许"}[e.canInvalid],1==e.canInvalid&&(t.invalidFee=e.invalidFee),t.remark=e.remark,t}function h(){$(".container ",document.body).width(),$("textarea.city").each(function(e,t){var i=$(t);i.css({"max-height":"auto","min-height":"auto"}),i.css("max-height",t.scrollHeight),t.scrollHeight<=110?i.css("min-height",t.scrollHeight):i.css("min-height",110)})}var m=n.search(),R=m.ctrl,y=m.id,b=u.ifpBaseUrl,v=_.indexOf(["ifpShowDouble","ifpOriginDouble"],R)>-1,C=_.indexOf(["ifpOrigin","ifpOriginDouble"],R)>-1;if(t.isDouble=v,t.isOrigin=C,t.data={},C){document.title="私有运价-修改后数据";var F=p(y);F.then(function(i){e.showLoading=!1,i&&i.success?i.data?(angular.extend(t.data,g(i.data)),c(h)):T(_.map(i.errMsg,function(e){return e}).join("<br>")||"未查询到数据").then(function(){}):T(_.map(i.errMsg,function(e){return e}).join("<br>")||"未查询到数据").then(function(){l.login(i)})},function(t){e.showLoading=!1,T(t==-1?"请求超时":"网络错误")})}else{document.title="私有运价-详情";var S=f(y);S.then(function(i){e.showLoading=!1,i&&i.success?i.data?(angular.extend(t.data,g(i.data)),t.data.logs=i.operateLog,c(h)):T(_.map(i.errMsg,function(e){return e}).join("<br>")||"未查询到数据").then(function(){}):T(_.map(i.errMsg,function(e){return e}).join("<br>")).then(function(){l.login(i)})},function(t){e.showLoading=!1,T(t==-1?"请求超时":"网络错误")})}t.originShowClick=function(e){window.open("./ifpShow.html?ctrl="+(v?"ifpOriginDouble":"ifpOrigin")+"&id="+encodeURIComponent(e.rowKey))},$(window).on("resize",function(){h()});var w=function(e){var i=s.open({templateUrl:"ifpDialog.html",bindToController:!0,controllerAs:"$ctrl",size:e.size,bindToController:!0,scope:t,backdrop:"static"});i.result.then(function(){"function"==typeof e.ok&&e.ok()},function(){"function"==typeof e.cancel&&e.cancel()}),t.dialogOkClick=function(){i.close()},t.dialogCancelClick=function(){i.dismiss()}},T=function(e){var i=a.defer();return t.dialogContent=e,w({size:"sm",ok:function(){i.resolve()}}),i.promise};e.showLoading=!0}]),angular.bootstrap(document,["ifpApp"])});