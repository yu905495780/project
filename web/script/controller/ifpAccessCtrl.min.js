define(["config/ifpConfig","service/ifpAPIService","service/ifpJumpService","filter/toTrustFilter.min"],function(e){e.controller("ifpAccessCtrl",["$rootScope","$scope","$http","$location","$filter","$q","$timeout","$uibModal","IFPAPIService","IFPJumpService",function(e,n,t,i,o,c,r,s,f,u,l){function a(){h();var e=c.defer();return t({method:"post",url:f.ifpBaseUrl+"access/create",timeout:1e4}).success(function(n){e.resolve(n),g()}).error(function(n,t){e.reject(t),g()}),e.promise}function p(e){e.success||(n.list=[],k(e.message||"系统异常"))}function d(){h();var e=c.defer();return t({method:"post",url:f.ifpBaseUrl+"access/search",timeout:1e4}).success(function(n){e.resolve(n),g()}).error(function(n,t){e.reject(t),g()}),e.promise}function m(e){e.success?e.data?n.list=e.data:n.list=[]:(n.list=[],k(e.message||"系统异常"))}function v(e){h();var n=c.defer();return t.post(f.ifpBaseUrl+"access/delete",{id:e}).success(function(e){g(),n.resolve(e)}).error(function(e){g(),n.reject(e)}),n.promise}function h(){e.showLoading=!0}function g(){e.showLoading=!1}n.list=[],d().then(function(e){m(e)},function(e){k(e==-1?"请求超时":"网络异常")}),function(e,n){e.addClick=function(){var n=a();n.then(function(n){p(n),d().then(function(e){m(e)},function(n){e.list=[],k(n==-1?"请求超时":"网络异常")})},function(e){k(e==-1?"请求超时":"网络异常")})},e.deleteClick=function(n){if(confirm("确定删除吗?")){var t=v(n.id);t.then(function(n){n&&n.success?(k("删除成功"),d().then(function(e){m(e)},function(n){k(n==-1?"请求超时":"网络异常"),e.list=[]})):k(n.message||"系统异常")},function(e){k("网络异常")})}},e.refreshClick=function(){d().then(function(e){m(e)},function(e){k(e==-1?"请求超时":"网络异常")})}}(n);var C=function(e){var t=s.open({templateUrl:"ifpDialog.html",bindToController:!0,controllerAs:"$ctrl",size:e.size,bindToController:!0,scope:n,backdrop:"static"});t.result.then(function(){"function"==typeof e.ok&&e.ok()},function(){"function"==typeof e.cancel&&e.cancel()}),n.dialogOkClick=function(){t.close()},n.dialogCancelClick=function(){t.dismiss()}},k=function(e){var t=c.defer();return n.dialogContent=e,C({size:"sm",ok:function(){t.resolve()}}),t.promise}}]),angular.bootstrap(document,["ifpApp"])});