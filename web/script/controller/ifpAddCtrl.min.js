define(["config/ifpConfig","service/ifpAPIService","service/ifpJumpService","filter/toTrustFilter","directive/chineseRestrict.min","directive/englishDigital.min","directive/digitalOnly.min","directive/zeroRestrict.min","directive/spaceRestrict.min","directive/englishComma.min","directive/englishDigitalComma.min","directive/englishDigitalCommaSlash.min","directive/englishDigitalDashSlash.min"],function(e){e.controller("ifpAddCtrl",["$rootScope","$scope","$http","$location","$filter","$q","$stateParams","$timeout","$uibModal","IFPAPIService","IFPJumpService",function(e,t,a,n,i,r,s,d,l,o,c,u){function f(e,t,a){var n=!0;angular.forEach(e.validate,function(e,t){e.valid=!0,e.reason=""});var i=["mainFileGroupCode","airline","depCities","arrCities","cabin","weekRestrictGo","saleRetention","passengerType","luggageWeightsBags"],r=["productType","stockType","addressOption","isTransfer","timeLimitType","canDepStay","currency","reserveType","canReimbursementVoucher","canChange","canRefund","noShowRestrict","luggageType","canInvalid","status"];w&&(i.push("minStay","maxStay","weekRestrictReturn"),r.push("bCanRt","canRetStay","canChangeRet","canRefundPartUnused"));for(var s=i.length;s--;){var l=i[s];""==((t[l]||"")+"").trim()&&(a[l].valid=!1,a[l].reason=a[l].defMsg,n=!1)}for(var s=r.length;s--;){var l=r[s];null!=t[l]&&(t[l]||"")+""!="-1"||(a[l].valid=!1,a[l].reason=a[l].defMsg,n=!1)}e.passengerTypeObj.adult?""==((t.filePrice||"")+"").trim()&&(a.filePrice.valid=!1,a.filePrice.reason=a.filePrice.defMsg,n=!1):(a.passengerType.valid=!1,a.passengerType.reason="成人是必选项",n=!1),e.passengerTypeObj.child&&""==((t.filePriceChild||"")+"").trim()&&(a.filePriceChild.valid=!1,a.filePriceChild.reason=a.filePriceChild.defMsg,n=!1),1==t.reserveType&&""==(t.officeNo||"").trim()&&(a.officeNo.valid=!1,a.officeNo.reason=a.officeNo.defMsg,n=!1),w&&"1"==t.bCanRt&&""==((t.canGroupFileCode||"")+"").trim()&&(a.canGroupFileCode.valid=!1,a.canGroupFileCode.reason=a.canGroupFileCode.defMsg,n=!1),"1"==t.isTransfer&&""==((t.transferCities||"")+"").trim()&&(a.transferCities.valid=!1,a.transferCities.reason=a.transferCities.defMsg,n=!1),""!=(t.saleStart||"").trim()&&""!=(t.saleEnd||"").trim()||(a.sale.valid=!1,a.sale.reason="请完善销售日期",n=!1);var o=e.dateRestrictGoValue;if(null==o.start||null==o.end){a.dateRestrictGo.valid=!1;var c="";w&&(c="去程"),a.dateRestrictGo.reason="请完善"+c+"旅行日期",n=!1}if(w){var u=e.dateRestrictReturnValue;null!=u.start&&null!=u.end||(a.dateRestrictReturn.valid=!1,a.dateRestrictReturn.reason="请完善回程旅行日期",n=!1)}var f=e.restrictGoForbidValue;f.length<=1?(null!=f[0].start&&null==f[0].end||null==f[0].start&&null!=f[0].end)&&(a.dateRestrictGoForbid.valid=!1,a.dateRestrictGoForbid.reason="请完善排除日期",n=!1):_.each(f,function(e){if(null==e.start||null==e.end)return a.dateRestrictGoForbid.valid=!1,a.dateRestrictGoForbid.reason="请完善排除日期",n=!1,!1});if(w){var p=e.restrictReturnForbidValue;p.length<=1?(null!=p[0].start&&null==p[0].end||null==p[0].start&&null!=p[0].end)&&(a.dateRestrictReturnForbid.valid=!1,a.dateRestrictReturnForbid.reason="请完善回程排除日期",n=!1):_.each(p,function(e){if(null==e.start||null==e.end)return a.dateRestrictReturnForbid.valid=!1,a.dateRestrictReturnForbid.reason="请完善回程排除日期",n=!1,!1})}return"1"==t.canRefund&&""==((t.refundFeeAllUnused||"")+"").trim()&&(a.refundFeeAllUnused.valid=!1,a.refundFeeAllUnused.reason=a.refundFeeAllUnused.defMsg,n=!1),"1"==t.canRefundPartUnused&&""==((t.refundFeePartUnused||"")+"").trim()&&(a.refundFeePartUnused.valid=!1,a.refundFeePartUnused.reason=a.refundFeePartUnused.defMsg,n=!1),"1"==t.canChange&&""==((t.changeFeeDep||"")+"").trim()&&(a.changeFeeDep.valid=!1,a.changeFeeDep.reason=a.changeFeeDep.defMsg,n=!1),w&&"1"==t.canChangeRet&&""==((t.changeFeeRet||"")+"").trim()&&(a.changeFeeRet.valid=!1,a.changeFeeRet.reason=a.changeFeeRet.defMsg,n=!1),"1"==t.noShowRestrict&&""==((t.noShowFee||"")+"").trim()&&(a.noShowFee.valid=!1,a.noShowFee.reason=a.noShowFee.defMsg,n=!1),"1"==t.canInvalid&&""==((t.invalidFee||"")+"").trim()&&(a.invalidFee.valid=!1,a.invalidFee.reason=a.invalidFee.defMsg,n=!1),n||d(h),n}function p(e){1!=e.bCanRt&&delete e.canGroupFileCode,1!=e.isTransfer&&delete e.transferCities,t.passengerTypeObj.adult||delete e.filePrice,t.passengerTypeObj.child||delete e.filePriceChild,1!=e.reserveType&&delete e.officeNo,1!=e.canChange&&delete e.changeFeeDep,1!=e.canChangeRet&&delete e.changeFeeRet,1!=e.canRefund&&delete e.refundFeeAllUnused,1!=e.canRefundPartUnused&&delete e.refundFeePartUnused,1!=e.noShowRestrict&&(delete e.noShowFee,delete e.noShowRemark),1!=e.canInvalid&&delete e.invalidFee}function g(e){e.airline&&(e.airline=e.airline.toUpperCase()),e.depCities&&(e.depCities=e.depCities.toUpperCase()),e.transferCities&&(e.transferCities=e.transferCities.toUpperCase()),e.arrCities&&(e.arrCities=e.arrCities.toUpperCase()),e.segmentFlightAllow&&(e.segmentFlightAllow=e.segmentFlightAllow.toUpperCase()),e.segmentFlightDeny&&(e.segmentFlightDeny=e.segmentFlightDeny.toUpperCase()),e.segmentAirlines&&(e.segmentAirlines=e.segmentAirlines.toUpperCase())}function R(e){/^\d+$/.test(e.filePrice)&&(e.filePrice=parseInt(e.filePrice,10)),/^\d+$/.test(e.filePriceChild)&&(e.filePriceChild=parseInt(e.filePriceChild,10)),/^\d+(\.\d+){0,1}$/.test(e.saleRetention)&&(e.saleRetention=parseFloat(e.saleRetention,10)),/^\d+$/.test(e.saleRebase)&&(e.saleRebase=parseInt(e.saleRebase,10)),/^\d+$/.test(e.changeFeeDep)&&(e.changeFeeDep=parseInt(e.changeFeeDep,10)),/^\d+$/.test(e.changeFeeRet)&&(e.changeFeeRet=parseInt(e.changeFeeRet,10)),/^\d+$/.test(e.refundFeeAllUnused)&&(e.refundFeeAllUnused=parseInt(e.refundFeeAllUnused,10)),/^\d+$/.test(e.refundFeePartUnused)&&(e.refundFeePartUnused=parseInt(e.refundFeePartUnused,10)),/^\d+$/.test(e.noShowFee)&&(e.noShowFee=parseInt(e.noShowFee,10)),/^\d+$/.test(e.luggageWeightsBags)&&(e.luggageWeightsBags=parseInt(e.luggageWeightsBags,10)),/^\d+$/.test(e.invalidFee)&&(e.invalidFee=parseInt(e.invalidFee,10))}function v(e){angular.forEach(t.validate,function(e,t){e.valid=!0,e.reason=""}),angular.forEach(e,function(e,a){var n=t.validate[a];n&&(t.validate[a].valid=!1,t.validate[a].reason=e)});var a=[];e.saleStart&&a.push(e.saleStart),e.saleEnd&&a.push(e.saleEnd),a.length>=1&&(t.validate.sale.valid=!1,t.validate.sale.reason=a.join(";")),e.officeNo&&(t.validate.officeNo.valid=!1,t.validate.officeNo.reason=e.officeNo)}function h(){var e=[],a=[];_.each(t.validate,function(t,n){if(0==t.valid){e.push(n);var i=$("."+n+"Location").offset();i&&i.top?a.push(i.top-10):console.info(n)}}),window.scrollTo(0,_.min(a))}function F(e){var t=r.defer();return m(),a.post(o.ifpBaseUrl+"policy/queryById",{id:e}).success(function(e){y(),t.resolve(e)}).error(function(e){y(),t.reject(e)}),t.promise}function C(e){_.each(e,function(t,a){"number"==typeof t&&(e[a]=t+"")}),t.data=e,T(),P(),k(),w&&(U(),N()),A(),p(e)}function m(){t.showLoading=!0}function y(){t.showLoading=!1}function b(e,t,n){var i={airline:e,transferType:t,travelType:n?2:1},s=r.defer();return a.post(o.ifpBaseUrl+"policy/completeAirlineCombine",i).success(function(e){s.resolve(e)}).error(function(e){s.reject(e)}),s.promise}var M=n.search(),G=M.ctrl||"",w="ifpAddDouble"==G||"ifpEditDouble"==G,S=G.indexOf("ifpEdit")>-1,D=M.id,V=o.ifpBaseUrl;t.data={id:0,mainFileGroupCode:"",externalId:"",productType:"-1",stockType:"-1",airline:"",addressOption:"-1",depCities:"",isTransfer:"0",transferCities:"",arrCities:"",cabin:"",grade:"-1",segmentAirlines:"",segmentFlightAllow:"",segmentFlightDeny:"",canDepStay:"-1",saleStart:"",saleEnd:"",dateRestrictGo:"",dateRestrictGoForbid:"",timeLimitType:"0",advancedSaleDate:"",weekRestrictGo:"",minPeopleNum:"",maxPeopleNum:"",passengerType:"",filePrice:"",filePriceChild:"",currency:"-1",saleRetention:"",saleRebase:"",reserveType:"-1",officeNo:"",canReimbursementVoucher:"-1",canChange:"-1",changeFeeDep:"",canRefund:"-1",refundFeeAllUnused:"",noShowRestrict:"-1",noShowFee:"",noShowRemark:"",buyTicketNotice:"",luggageType:"-1",luggageWeightsBags:"",canInvalid:"-1",invalidFee:"",remark:"",status:"-1",travelType:w?2:1},w&&(t.data.cabin="",t.data.bCanRt="-1",t.data.canGroupFileCode="",t.data.canRetStay="-1",t.data.minStay="",t.data.maxStay="",t.data.weekRestrictReturn="",t.data.canChangeRet="-1",t.data.changeFeeRet="",t.data.canRefundPartUnused="-1",t.data.refundFeePartUnused="",t.data.dateRestrictReturn="",t.data.dateRestrictReturnForbid=""),t.isDouble=w,t.validate={mainFileGroupCode:{valid:!0,reason:"",defMsg:"请输入文件编号"},externalId:{valid:!0,reason:""},productType:{valid:!0,reason:"",defMsg:"请选择产品类型"},stockType:{valid:!0,reason:"",defMsg:"请选择库存模式"},airline:{valid:!0,reason:"",defMsg:"请输入开票航司"},addressOption:{valid:!0,reason:"",defMsg:"请选择录入方式"},depCities:{valid:!0,reason:"",defMsg:"请输入出发地"},isTransfer:{valid:!0,reason:"",defMsg:"请选择是否中转"},transferCities:{valid:!0,reason:"",defMsg:"请输入中转点"},arrCities:{valid:!0,reason:"",defMsg:"请输入目的地"},cabin:{valid:!0,reason:"",defMsg:"请输入适用舱位"},grade:{valid:!0,reason:"请选择舱位等级"},segmentAirlines:{valid:!0,reason:""},segmentFlightAllow:{valid:!0,reason:""},segmentFlightDeny:{valid:!0,reason:""},canDepStay:{valid:!0,reason:"",defMsg:"请选择"},sale:{valid:!0,reason:""},dateRestrictGo:{valid:!0,reason:""},dateRestrictGoForbid:{valid:!0,reason:""},timeLimitType:{valid:!0,reason:""},advancedSaleDate:{valid:!0,reason:""},weekRestrictGo:{valid:!0,reason:"",defMsg:"请输入适用班期"},minPeopleNum:{valid:!0,reason:""},maxPeopleNum:{valid:!0,reason:""},passengerType:{valid:!0,reason:"",defMsg:"请选择适用旅客"},filePrice:{valid:!0,reason:"",defMsg:"请输入成人销售票面"},filePriceChild:{valid:!0,reason:"",defMsg:"请输入儿童销售票面"},currency:{valid:!0,reason:"",defMsg:"请选择结算币种"},saleRetention:{valid:!0,reason:"",defMsg:"请输入返点值"},saleRebase:{valid:!0,reason:""},reserveType:{valid:!0,reason:"",defMsg:"请选择预订配置"},officeNo:{valid:!0,reason:"",defMsg:"请填写office号"},officeNo1:{valid:!0,reason:"",defMsg:"请填写officeNo"},officeNo2:{valid:!0,reason:"",defMsg:"请填写officeNo"},canReimbursementVoucher:{valid:!0,reason:"",defMsg:"请选择"},canChange:{valid:!0,reason:"",defMsg:"请选择"},canChangeValueDep:{valid:!0,reason:"",defMsg:"请选择"},changeFeeDep:{valid:!0,reason:"",defMsg:"请输入改期费"},canRefund:{valid:!0,reason:"",defMsg:"请选择"},refundFeeAllUnused:{valid:!0,reason:"",defMsg:"请输入全部未使用退票费"},noShowRestrict:{valid:!0,reason:"",defMsg:"请选择"},noShowFee:{valid:!0,reason:"",defMsg:"请输入NoShow费"},noShowRemark:{valid:!0,reason:""},buyTicketNotice:{valid:!0,reason:""},luggageType:{valid:!0,reason:"",defMsg:"请选择行李规格"},luggageWeightsBags:{valid:!0,reason:"",defMsg:"请输入行李额"},canInvalid:{valid:!0,reason:"",defMsg:"请选择"},invalidFee:{valid:!0,reason:"",defMsg:"请输入废票费"},remark:{valid:!0,reason:""},status:{valid:!0,reason:"",defMsg:"请选择"},travelType:{valid:!0,reason:""}},w&&(t.validate.bCanRt={valid:!0,reason:"",defMsg:"请选择"},t.validate.canGroupFileCode={valid:!0,reason:"",defMsg:"请输入可组合文件号"},t.validate.canRetStay={valid:!0,reason:"",defMsg:"请选择"},t.validate.minStay={valid:!0,reason:"",defMsg:"请输入最短停留天数"},t.validate.maxStay={valid:!0,reason:"",defMsg:"请输入最长停留天数"},t.validate.canChangeRet={valid:!0,reason:"",defMsg:"请选择"},t.validate.changeFeeRet={valid:!0,reason:"",defMsg:"请输入回程改期费"},t.validate.changeFeeDep={valid:!0,reason:"",defMsg:"请输入去程改期费"},t.validate.weekRestrictGo={valid:!0,reason:"",defMsg:"请输入去程适用班期"},t.validate.weekRestrictReturn={valid:!0,reason:"",defMsg:"请输入回程适用班期"},t.validate.dateRestrictReturn={valid:!0,reason:""},t.validate.dateRestrictReturnForbid={valid:!0,reason:""},t.validate.canChangeValueRet={valid:!0,reason:"",defMsg:"请选择"},t.validate.canRefundPartUnused={valid:!0,reason:"",defMsg:"请选择"},t.validate.refundFeePartUnused={valid:!0,reason:"",defMsg:"请输入部分使用退票费"});var O=u;!function(e,t){e.officeNos=[],O=function(){var t=[];t=(e.data.officeNo||"").split(","),t.length<=1&&t.push(""),e.officeNos=angular.extend(e.officeNos,t)},e.$watchCollection("officeNos",function(){var t=[];(e.officeNos[0]||"").trim()&&t.push((e.officeNos[0]||"").trim()),(e.officeNos[1]||"").trim()&&t.push((e.officeNos[1]||"").trim()),e.data.officeNo=t.join(",")})}(t);var T=u,P=u,k=u,U=u,N=u;!function(e,t){var a=e.data.saleStart||"",n=e.data.saleEnd||"";e.saleValue={start:a?new Date(a.replace(/-/gi,"/")):null,end:n?new Date(n.replace(/-/gi,"/")):null},e.saleOption={start:{},end:{minDate:e.saleValue.start}},T=function(){a=e.data.saleStart||"",n=e.data.saleEnd||"",e.saleValue={start:a?new Date(a.replace(/-/gi,"/")):null,end:n?new Date(n.replace(/-/gi,"/")):null},e.saleOption.end.minDate=e.saleValue.start},e.saleStartOpenClick=function(){e.saleStartCalOpen=!0},e.saleStartChange=function(){e.saleOption.end.minDate=e.saleValue.start,e.saleValue.start>(e.saleValue.end||null)&&(e.saleValue.end=e.saleValue.start)},e.saleEndOpenClick=function(){e.saleEndCalOpen=!0},e.$watchCollection("saleValue",function(){e.data.saleStart=i("date")(e.saleValue.start,"yyyy-MM-dd")||"",e.data.saleEnd=i("date")(e.saleValue.end,"yyyy-MM-dd")||""});var r=e.data.dateRestrictGo.split(">"),s=r[0]||"",d=r[1]||"";if(e.dateRestrictGoValue={start:s?new Date(s.replace(/-/gi,"/")):null,end:d?new Date(d.replace(/-/gi,"/")):null},e.dateRestrictGoOption={start:{},end:{minDate:e.dateRestrictGoValue.start}},P=function(){r=e.data.dateRestrictGo.split(">"),s=r[0]||"",d=r[1]||"",e.dateRestrictGoValue={start:s?new Date(s.replace(/-/gi,"/")):null,end:d?new Date(d.replace(/-/gi,"/")):null},e.dateRestrictGoOption.end.minDate=e.dateRestrictGoValue.start},e.dateRestrictGoStartOpenClick=function(){e.dateRestrictGoStartCalOpen=!0},e.dateRestrictGoStartChange=function(){e.dateRestrictGoOption.end.minDate=e.dateRestrictGoValue.start,e.dateRestrictGoValue.start>(e.dateRestrictGoValue.end||null)&&(e.dateRestrictGoValue.end=e.dateRestrictGoValue.start)},e.dateRestrictGoEndOpenClick=function(){e.dateRestrictGoEndCalOpen=!0},e.$watchCollection("dateRestrictGoValue",function(){e.data.dateRestrictGo=[i("date")(e.dateRestrictGoValue.start,"yyyy-MM-dd")||"",i("date")(e.dateRestrictGoValue.end,"yyyy-MM-dd")||""].join(">")}),w){var l=e.data.dateRestrictReturn.split(">"),o=l[0]||"",c=l[1]||"";e.dateRestrictReturnValue={start:o?new Date(o.replace(/-/gi,"/")):null,end:c?new Date(c.replace(/-/gi,"/")):null},e.dateRestrictReturnOption={start:{},end:{minDate:e.dateRestrictReturnValue.start}},U=function(){l=e.data.dateRestrictReturn.split(">"),o=l[0]||"",c=l[1]||"",e.dateRestrictReturnValue={start:o?new Date(o.replace(/-/gi,"/")):null,end:c?new Date(c.replace(/-/gi,"/")):null},e.dateRestrictReturnOption.end.minDate=e.dateRestrictReturnValue.start},e.dateRestrictReturnStartOpenClick=function(){e.dateRestrictReturnStartCalOpen=!0},e.dateRestrictReturnStartChange=function(){e.dateRestrictReturnOption.end.minDate=e.dateRestrictReturnValue.start,e.dateRestrictReturnValue.start>(e.dateRestrictReturnValue.end||null)&&(e.dateRestrictReturnValue.end=e.dateRestrictReturnValue.start)},e.dateRestrictReturnEndOpenClick=function(){e.dateRestrictReturnEndCalOpen=!0},e.$watchCollection("dateRestrictReturnValue",function(){e.data.dateRestrictReturn=[i("date")(e.dateRestrictReturnValue.start,"yyyy-MM-dd")||"",i("date")(e.dateRestrictReturnValue.end,"yyyy-MM-dd")||""].join(">")})}var u=e.data.dateRestrictGoForbid.split(",");if(e.restrictGoForbidValue=[],k=function(){e.data.dateRestrictGoForbid&&(u=e.data.dateRestrictGoForbid.split(","),_.each(u,function(a,n){var i=a.split(">");e.restrictGoForbidValue.push({start:i[0]?new Date(i[0].replace(/-/gi,"/")):t,startOpen:!1,end:i[1]?new Date(i[1].replace(/-/gi,"/")):t,endOpen:!1,endMinDate:i[0]?new Date(i[0].replace(/-/gi,"/")):t})})),e.restrictGoForbidValue.length<=0&&e.restrictGoForbidValue.push({start:null,end:null})},S||k(),e.dateRestrictGoForbidStartOpenClick=function(e){e.startOpen=!0},e.dateRestrictGoForbidStartChange=function(t){t.endMinDate=t.start,t.start>(t.end||null)&&(t.end=t.start),e.dateRestrictGoForbidEndChange()},e.dateRestrictGoForbidEndChange=function(t){var a=e.restrictGoForbidValue,n=[];angular.forEach(a,function(e,t){n.push([i("date")(e.start,"yyyy-MM-dd")||"",i("date")(e.end,"yyyy-MM-dd")||""].join(">"))}),n.length<=1&&">"==n[0]?e.data.dateRestrictGoForbid="":e.data.dateRestrictGoForbid=n.join(",")},e.$watchCollection("restrictGoForbidValue",function(){e.dateRestrictGoForbidEndChange()}),e.dateRestrictGoForbidStartEndClick=function(e){e.endOpen=!0},e.restrictGoForbidAddClick=function(t){e.restrictGoForbidValue.splice(t+1,0,{start:null,startOpen:!1,end:null,endOpen:!1})},e.restrictGoForbidPlusClick=function(t){e.restrictGoForbidValue.splice(t,1)},w){var f=e.data.dateRestrictReturnForbid.split(",");e.restrictReturnForbidValue=[],N=function(){e.data.dateRestrictReturnForbid&&(f=e.data.dateRestrictReturnForbid.split(","),_.each(f,function(a,n){var i=a.split(">");e.restrictReturnForbidValue.push({start:i[0]?new Date(i[0].replace(/-/gi,"/")):t,startOpen:!1,end:i[1]?new Date(i[1].replace(/-/gi,"/")):t,endOpen:!1,endMinDate:i[0]?new Date(i[0].replace(/-/gi,"/")):t})})),e.restrictReturnForbidValue.length<=0&&e.restrictReturnForbidValue.push({start:null,end:null})},S||N(),e.dateRestrictReturnForbidStartOpenClick=function(e){e.startOpen=!0},e.dateRestrictReturnForbidStartChange=function(t){t.endMinDate=t.start,t.start>(t.end||null)&&(t.end=t.start),e.dateRestrictReturnForbidEndChange()},e.dateRestrictReturnForbidEndChange=function(t){var a=e.restrictReturnForbidValue,n=[];angular.forEach(a,function(e,t){n.push([i("date")(e.start,"yyyy-MM-dd")||"",i("date")(e.end,"yyyy-MM-dd")||""].join(">"))}),n.length<=1&&">"==n[0]?e.data.dateRestrictReturnForbid="":e.data.dateRestrictReturnForbid=n.join(",")},e.$watchCollection("restrictReturnForbidValue",function(){e.dateRestrictReturnForbidEndChange()}),e.dateRestrictReturnForbidStartEndClick=function(e){e.endOpen=!0},e.restrictReturnForbidAddClick=function(t){e.restrictReturnForbidValue.splice(t+1,0,{start:null,startOpen:!1,end:null,endOpen:!1})},e.restrictReturnForbidPlusClick=function(t){e.restrictReturnForbidValue.splice(t,1)}}}(t);var A=u;!function(e,t){e.passengerTypeObj={adult:!0,child:!1,student:!1};var a={adult:1,child:0,student:2},n={1:"adult",0:"child",2:"student"};A=function(){var t=e.data.passengerType.split(",");_.each(t,function(t,a){e.passengerTypeObj[n[t]]=!0})},e.$watchCollection("passengerTypeObj",function(){var t=[];angular.forEach(e.passengerTypeObj,function(e,n){e&&t.push(a[n])}),e.data.passengerType=t.join(",")})}(t),t.saveClick=function(e){if(f(t,t.data,t.validate)){var n=angular.extend({},t.data);p(n),g(n),R(n),m();var i="";i=S?w?"policy/updateRt":"policy/updateOw":w?"policy/insertRt":"policy/insertOw",a.post(V+i,n).success(function(e){e.success?I("保存成功").then(function(){window.close()}):(I(_.filter(e.errMsg,function(e,t){if("overdue"==t)return e}).join("<br>")||"保存失败").then(function(){h(),c.login(e)}),v(e.errMsg),window.scrollTo(0,0)),y()}).error(function(e,t){I("-1"==t?"请求超时":"网络错误"),y()})}};var E=function(e){var a=l.open({templateUrl:"ifpDialog.html",bindToController:!0,controllerAs:"$ctrl",size:e.size,bindToController:!0,scope:t,backdrop:"static"});a.result.then(function(){"function"==typeof e.ok&&e.ok()},function(){"function"==typeof e.cancel&&e.cancel()}),t.dialogOkClick=function(){a.close()},t.dialogCancelClick=function(){a.dismiss()}},I=function(e){var a=r.defer();return t.dialogContent=e,E({size:"sm",ok:function(){a.resolve()}}),a.promise};if(S){var j=D;F(j).then(function(e){e&&e.success?C(e.data):I(_.map(e.errMsg,function(e){return e}).join("<br>")).then(function(){c.login(e)})},function(){I("网络错误")})}t.handleAirlineCombine=function(){""!=t.data.airline&&"-1"!=t.data.isTransfer&&b(t.data.airline,t.data.isTransfer,w).then(function(e){e&&e.success&&(t.data.segmentAirlines=e.data)},function(){I("网络错误")})},t.closeClick=function(e){window.close()},t.pageShow=!0}]),angular.bootstrap(document,["ifpApp"])});