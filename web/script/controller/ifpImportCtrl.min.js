define(["config/ifpConfig","service/ifpAPIService","service/ifpJumpService","filter/toTrustFilter",],function(n){n.controller("ifpImportCtrl",["$scope","$http","$location","$filter","$q","$stateParams","$timeout","IFPAPIService","IFPJumpService","uiUploader",function(n,t,i,r,u,f,e,o,s,h){function a(){if(n.ierrMsg=[],h.files.length==0)n.ierrMsg.push({msg:"请先选择文件"});else if(h.files.length>3)n.ierrMsg.push({msg:"选择文件超过3个"});else for(var t=0;t<h.files.length;t++)if(h.files[t].size>5242880){n.ierrMsg.push({msg:h.files[t].name+"的大小超过5MB"});break}return n.ierrMsg.length>0?!1:!0}var v=f.id,l=n.isDouble=i.search().ctrl=="ifpImportDouble",c;n.acceptType="application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";n.ierrMsg=[];n.isImport=!1;n.isFinished=!1;n.btn_remove=function(t){n.isImport||(h.removeFile(t),n.isFinished=!1)};n.files=[];c=document.getElementById("file1");c.addEventListener("change",function(t){var i=t.target.files;h.removeAll();h.addFiles(i);n.files=h.getFiles();n.isFinished=!1;n.ierrMsg.length=0;n.$apply()});n.btn_upload=function(){n.isFinished=!1;var t=h.files.length;a()!=!1&&(n.isImport=!0,h.startUpload({url:o.ifpBaseUrl+"policy/upload",data:{travelType:l?2:1},headers:{Accept:"application/json"},concurrency:2,onProgress:function(){n.$apply()},onCompleted:function(t,i){var r=JSON.parse(i||"{}");n.isImport=!1;r.success?(n.isFinished=!0,n.successMsg=r.data):(n.ierrMsg.length=0,n.ierrMsg.push({msg:_.map(r.errMsg,function(n){return n}).join("<br>")||"上传失败"}));h.removeAll();n.$apply();document.forms.fileUploader.reset()},onError:function(){n.ierrMsg.length=0;n.ierrMsg.push({msg:"上传异常"});n.isImport=!1;n.$apply();document.forms.fileUploader.reset()}}))}}]);angular.bootstrap(document,["ifpApp"])});